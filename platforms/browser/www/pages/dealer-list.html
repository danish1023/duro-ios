<template>
  <div class="page" id="dealer-list-page">
    <div class="navbar">
      <div class="navbar-inner sliding bg-color-red color-theme-white">
        <div class="left">
          <a href="#" class="link back">
            <i class="material-icons">arrow_back</i>
          </a>
        </div>
        <div class="title color-white">Mapped Dealers</div>
      </div>
    </div>
    <div class="page-content bg-color-white">

    </div>
  </div>
</template>
<script>
  return {
    data: function () {
      var UserData = JSON.parse(localStorage.User);
      return {
        data: UserData,
      }
    },
    on: {
      pageInit: function (e, page) {
        var User = localStorage.User;
        var UserData = JSON.parse(User);
        var obj = {
          UserName: UserData.MembershipId,
        };
        app.request({
          url: BaseURL + '/ListDealerAPI',
          method: 'POST',
          dataType: 'json',
          data: obj,
          contentType: 'application/json',
          beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization", "Basic " + btoa(AuthUsername + ":" + AuthPassword));
            var spinnerOptions = { dimBackground: false };
            SpinnerPlugin.activityStart(null, spinnerOptions);
          },
          error: function (xhr, status) {
            alert("Error: " + status);
          },
          success: function (data, status, xhr) {
            if (data.ErrorCode == '0') {
              var TotalMappedDealer = data.TotalMappedDealer;
              var ActiveMappedDealer = data.ActiveMappedDealer;
              var InActiveMappedDealer = data.InActiveMappedDealer;
              var DealerListDetails = data.Response.DealerListDetails;
              if (DealerListDetails) {
                var tbody_active = '';
                var tbody_inactive = '';
                for (var i = 0; i < DealerListDetails.length; i++) {
                  var DealerName = DealerListDetails[i].DealerName;
                  var DealerMobileNo = DealerListDetails[i].DealerMobileNo;
                  var DealerStatus = DealerListDetails[i].DealerStatus;
                  var CopounAlloted = DealerListDetails[i].CopounAlloted;
                  var CouponPending = DealerListDetails[i].CouponPending;
                  var CouponClaimed = DealerListDetails[i].CouponClaimed;
                  var tbody_el = `
                    <tr>
                      <td class="label-cell"><a href="/dealer-details/${DealerMobileNo}/">${DealerName}</a></td>
                      <td class="label-cell">${DealerMobileNo}</td>
                      <td class="label-cell">${CopounAlloted}</td>
                      <td class="label-cell">${CouponPending}</td>
                      <td class="label-cell">${CouponClaimed}</td>
                    </tr>`;
                  if (DealerStatus == 'Yes') {
                    tbody_active = tbody_active + tbody_el;
                  }
                  else {
                    tbody_inactive = tbody_inactive + tbody_el;
                  }
                }
              }
              var html = `
              <div class="list accordion-list margin-top">
                <ul>
                  <li class="accordion-item">
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title">Enrolled Members</div>
                        <div class="item-after" style="padding-right: 26px">${TotalMappedDealer}</div>
                      </div>
                    </div>
                  </li>
                  <li class="accordion-item">
                    <a href="#" class="item-link item-content">
                      <div class="item-inner">
                        <div class="item-title">Active Members</div>
                        <div class="item-after">${ActiveMappedDealer}</div>
                      </div>
                    </a>
                    <div class="accordion-item-content active-dealers">
                        <div class="data-table">
                          <table>
                            <thead>
                              <tr>
                                <th class="label-cell color-red">Dealer Name</th>
                                <th class="label-cell color-red">Dealer Mobile</th>
                                <th class="label-cell color-red">Copoun Alloted</th>
                                <th class="label-cell color-red">Coupon Pending</th>
                                <th class="label-cell color-red">Coupon Claimed</th>
                              </tr>
                            </thead>
                            <tbody>
                              ${tbody_active}
                            </tbody>
                          </table>
                        </div>
                    </div>
                  </li>
                  <li class="accordion-item">
                    <a href="#" class="item-link item-content">
                      <div class="item-inner">
                        <div class="item-title">Inactive Members</div>
                        <div class="item-after">${InActiveMappedDealer}</div>
                      </div>
                    </a>
                    <div class="accordion-item-content inactive-dealers">
                        <div class="data-table">
                          <table>
                            <thead>
                              <tr>
                                <th class="label-cell color-red">Dealer Name</th>
                                <th class="label-cell color-red">Dealer Mobile</th>
                                <th class="label-cell color-red">Copoun Alloted</th>
                                <th class="label-cell color-red">Coupon Pending</th>
                                <th class="label-cell color-red">Coupon Claimed</th>
                              </tr>
                            </thead>
                            <tbody>
                              ${tbody_inactive}
                            </tbody>
                          </table>
                        </div>
                    </div>
                  </li>
                </ul>
              </div>`;
            $$('#dealer-list-page .page-content').html(html);
            }
            else {
              app.dialog.alert(data.ErrorMessage);
            }
          },
          complete: function (xhr, status) {
            SpinnerPlugin.activityStop();
          }
        })
      }
    }
  }
</script>